{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_markdown/settings.coffee","meteor://ðŸ’»app/packages/rocketchat_markdown/markdown.coffee"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,MAAM,CAAC,OAAP,CAAe;AACb,YAAU,CAAC,QAAQ,CAAC,GAApB,CAAwB,kBAAxB,EAA4C,KAA5C,EAAmD;AAAA,IAAC,MAAM,SAAP;AAAA,IAAkB,OAAO,SAAzB;AAAA,IAAoC,SAAS,UAA7C;AAAA,IAAyD,UAAQ,IAAjE;GAAnD;SACA,UAAU,CAAC,QAAQ,CAAC,GAApB,CAAwB,gCAAxB,EAA0D,YAA1D,EAAwE;AAAA,IAAC,MAAM,QAAP;AAAA,IAAiB,OAAO,SAAxB;AAAA,IAAmC,SAAS,UAA5C;AAAA,IAAwD,UAAQ,IAAhE;AAAA,IAAsE,iBAAiB,4CAAvF;GAAxE,EAFa;AAAA,CAAf;;;;;;;;;;;;;;;;;;;;ACAA;AAAA;;;GAAA;AAAA;;AAAA;AAMc,oBAAC,OAAD;AACZ;AAAA,UAAM,OAAN;AAEA,QAAG,EAAK,CAAC,QAAF,CAAW,OAAX,CAAP;AACC,UAAG,CAAC,CAAC,IAAF,mBAAO,OAAO,CAAE,aAAhB,CAAH;AACC,cAAM,OAAO,CAAC,IAAd,CADD;OAAA;AAGC,eAAO,OAAP,CAHD;OADD;KAFA;AASA,QAAG,CAAC,CAAC,QAAF,CAAW,OAAX,CAAH;AACC,YAAM,GAAG,CAAC,OAAJ,CAAY,mDAAZ,EAAiE,+GAAjE,CAAN,CADD;KAAA;;QAGC,OAAO,CAAC,SAAU;OAAlB;AAAA,MACA,MAAM,GAAG,CAAC,OAAJ,CAAY,mDAAZ,EAAiE,SAAC,KAAD,EAAQ,EAAR,EAAY,EAAZ,EAAgB,EAAhB,EAAoB,MAApB,EAA4B,IAA5B;AACtE;AAAA,gBAAQ,MAAG,CAAC,MAAM,CAAC,EAAP,EAAD,CAAH,GAAgB,GAAxB;AAAA,QAEA,OAAO,CAAC,MAAM,CAAC,IAAf,CACC;AAAA,iBAAO,KAAP;AAAA,UACA,MAAS,EAAD,GAAI,gEAAJ,GAAoE,EAApE,GAAuE,iDAAvE,GAAwH,EADhI;SADD,CAFA;AAMA,eAAO,KAAP,CAPsE;MAAA,CAAjE,CADN,CAHD;KATA;AAAA,IAsBA,UAAU,UAAU,CAAC,QAAQ,CAAC,GAApB,CAAwB,gCAAxB,CAAyD,CAAC,KAA1D,CAAgE,GAAhE,CAAoE,CAAC,IAArE,CAA0E,GAA1E,CAtBV;AAAA,IAyBA,MAAM,GAAG,CAAC,OAAJ,CAAgB,WAAO,4BAA0B,OAA1B,GAAkC,qBAAzC,EAA+D,IAA/D,CAAhB,EAAsF,kIAAtF,CAzBN;AAAA,IA4BA,MAAM,GAAG,CAAC,OAAJ,CAAgB,WAAO,2BAAyB,OAAzB,GAAiC,qBAAxC,EAA8D,IAA9D,CAAhB,EAAqF,qCAArF,CA5BN;AAAA,IA+BA,MAAM,GAAG,CAAC,OAAJ,CAAgB,WAAO,mBAAiB,OAAjB,GAAyB,8CAAhC,EAA+E,IAA/E,CAAhB,EAAsG,qCAAtG,CA/BN;AAiCA,QAAG,UAAU,CAAC,QAAQ,CAAC,GAApB,CAAwB,kBAAxB,CAAH;AAEC,YAAM,GAAG,CAAC,OAAJ,CAAY,+BAAZ,EAA6C,aAA7C,CAAN;AAAA,MAGA,MAAM,GAAG,CAAC,OAAJ,CAAY,gCAAZ,EAA8C,aAA9C,CAHN;AAAA,MAMA,MAAM,GAAG,CAAC,OAAJ,CAAY,iCAAZ,EAA+C,aAA/C,CANN;AAAA,MASA,MAAM,GAAG,CAAC,OAAJ,CAAY,kCAAZ,EAAgD,aAAhD,CATN,CAFD;KAjCA;AAAA,IA+CA,MAAM,GAAG,CAAC,OAAJ,CAAY,8DAAZ,EAA4E,uFAA5E,CA/CN;AAAA,IAkDA,MAAM,GAAG,CAAC,OAAJ,CAAY,oDAAZ,EAAkE,+EAAlE,CAlDN;AAAA,IAqDA,MAAM,GAAG,CAAC,OAAJ,CAAY,6DAAZ,EAA2E,uFAA3E,CArDN;AAAA,IA2DA,MAAM,GAAG,CAAC,OAAJ,CAAY,yCAAZ,EAAuD,iHAAvD,CA3DN;AAAA,IA8DA,MAAM,GAAG,CAAC,OAAJ,CAAY,cAAZ,EAA4B,+DAA5B,CA9DN;AAAA,IAiEA,MAAM,GAAG,CAAC,OAAJ,CAAY,mBAAZ,EAAiC,cAAjC,CAjEN;AAAA,IAkEA,MAAM,GAAG,CAAC,OAAJ,CAAY,qBAAZ,EAAmC,eAAnC,CAlEN;AAAA,IAqEA,MAAM,GAAG,CAAC,OAAJ,CAAY,gCAAZ,EAA8C,2BAA9C,CArEN;AAuEA,QAAG,EAAK,CAAC,QAAF,CAAW,OAAX,CAAP;AACC,aAAO,CAAC,IAAR,GAAe,GAAf,CADD;KAAA;AAGC,gBAAU,GAAV,CAHD;KAvEA;AA4EA,2DAAmC,MAAM,CAAE,oBAA3C;AAAA,aAAO,CAAC,GAAR,CAAY,UAAZ,EAAwB,OAAxB;KA5EA;AA8EA,WAAO,OAAP,CA/EY;EAAA,CAAb;;kBAAA;;IAND;;AAAA,UAuFU,CAAC,SAAS,CAAC,GAArB,CAAyB,eAAzB,EAA0C,QAA1C,EAAoD,UAAU,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAlF,CAvFA;;AAAA,UAwFU,CAAC,QAAX,GAAsB,QAxFtB;;AA0FA,IAAG,MAAM,CAAC,QAAV;AACC,OAAK,CAAC,cAAN,CAAqB,oBAArB,EAA2C,SAAC,IAAD;AAC1C,WAAO,UAAU,CAAC,QAAX,CAAoB,IAApB,CAAP,CAD0C;EAAA,CAA3C,EADD;CA1FA","file":"/packages/rocketchat_markdown.js","sourcesContent":["Meteor.startup ->\n  RocketChat.settings.add 'Markdown_Headers', false, {type: 'boolean', group: 'Message', section: 'Markdown', public: true}\n  RocketChat.settings.add 'Markdown_SupportSchemesForLink', 'http,https', {type: 'string', group: 'Message', section: 'Markdown', public: true, i18nDescription: 'Markdown_SupportSchemesForLink_Description'}\n","###\n# Markdown is a named function that will parse markdown syntax\n# @param {Object} message - The message object\n###\n\nclass Markdown\n\tconstructor: (message) ->\n\t\tmsg = message\n\n\t\tif not _.isString message\n\t\t\tif _.trim message?.html\n\t\t\t\tmsg = message.html\n\t\t\telse\n\t\t\t\treturn message\n\n\t\t# Support `text`\n\t\tif _.isString message\n\t\t\tmsg = msg.replace(/(^|&gt;|[ >_*~])\\`([^`\\r\\n]+)\\`([<_*~]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">`</span><span><code class=\"inline\">$2</code></span><span class=\"copyonly\">`</span>$3')\n\t\telse\n\t\t\tmessage.tokens ?= []\n\t\t\tmsg = msg.replace /(^|&gt;|[ >_*~])\\`([^`\\r\\n]+)\\`([<_*~]|\\B|\\b|$)/gm, (match, p1, p2, p3, offset, text) ->\n\t\t\t\ttoken = \"$#{Random.id()}$\"\n\n\t\t\t\tmessage.tokens.push\n\t\t\t\t\ttoken: token\n\t\t\t\t\ttext: \"#{p1}<span class=\\\"copyonly\\\">`</span><span><code class=\\\"inline\\\">#{p2}</code></span><span class=\\\"copyonly\\\">`</span>#{p3}\"\n\n\t\t\t\treturn token\n\n\t\tschemes = RocketChat.settings.get('Markdown_SupportSchemesForLink').split(',').join('|')\n\n\t\t# Support ![alt text](http://image url)\n\t\tmsg = msg.replace(new RegExp(\"!\\\\[([^\\\\]]+)\\\\]\\\\(((?:#{schemes}):\\\\/\\\\/[^\\\\)]+)\\\\)\", 'gm'), '<a href=\"$2\" title=\"$1\" class=\"swipebox\" target=\"_blank\"><div class=\"inline-image\" style=\"background-image: url($2);\"></div></a>')\n\n\t\t# Support [Text](http://link)\n\t\tmsg = msg.replace(new RegExp(\"\\\\[([^\\\\]]+)\\\\]\\\\(((?:#{schemes}):\\\\/\\\\/[^\\\\)]+)\\\\)\", 'gm'), '<a href=\"$2\" target=\"_blank\">$1</a>')\n\n\t\t# Support <http://link|Text>\n\t\tmsg = msg.replace(new RegExp(\"(?:<|&lt;)((?:#{schemes}):\\\\/\\\\/[^\\\\|]+)\\\\|(.+?)(?=>|&gt;)(?:>|&gt;)\", 'gm'), '<a href=\"$1\" target=\"_blank\">$2</a>')\n\n\t\tif RocketChat.settings.get('Markdown_Headers')\n\t\t\t# Support # Text for h1\n\t\t\tmsg = msg.replace(/^# (([\\w\\d-_\\/\\*\\.,\\\\] ?)+)/gm, '<h1>$1</h1>')\n\n\t\t\t# Support # Text for h2\n\t\t\tmsg = msg.replace(/^## (([\\w\\d-_\\/\\*\\.,\\\\] ?)+)/gm, '<h2>$1</h2>')\n\n\t\t\t# Support # Text for h3\n\t\t\tmsg = msg.replace(/^### (([\\w\\d-_\\/\\*\\.,\\\\] ?)+)/gm, '<h3>$1</h3>')\n\n\t\t\t# Support # Text for h4\n\t\t\tmsg = msg.replace(/^#### (([\\w\\d-_\\/\\*\\.,\\\\] ?)+)/gm, '<h4>$1</h4>')\n\n\t\t# Support *text* to make bold\n\t\tmsg = msg.replace(/(^|&gt;|[ >_~`])\\*{1,2}([^\\*\\r\\n]+)\\*{1,2}([<_~`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">*</span><strong>$2</strong><span class=\"copyonly\">*</span>$3')\n\n\t\t# Support _text_ to make italics\n\t\tmsg = msg.replace(/(^|&gt;|[ >*~`])\\_([^\\_\\r\\n]+)\\_([<*~`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">_</span><em>$2</em><span class=\"copyonly\">_</span>$3')\n\n\t\t# Support ~text~ to strike through text\n\t\tmsg = msg.replace(/(^|&gt;|[ >_*`])\\~{1,2}([^~\\r\\n]+)\\~{1,2}([<_*`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">~</span><strike>$2</strike><span class=\"copyonly\">~</span>$3')\n\n\t\t# Support for block quote\n\t\t# >>>\n\t\t# Text\n\t\t# <<<\n\t\tmsg = msg.replace(/(?:&gt;){3}\\n+([\\s\\S]*?)\\n+(?:&lt;){3}/g, '<blockquote><span class=\"copyonly\">&gt;&gt;&gt;</span>$1<span class=\"copyonly\">&lt;&lt;&lt;</span></blockquote>')\n\n\t\t# Support >Text for quote\n\t\tmsg = msg.replace(/^&gt;(.*)$/gm, '<blockquote><span class=\"copyonly\">&gt;</span>$1</blockquote>')\n\n\t\t# Remove white-space around blockquote (prevent <br>). Because blockquote is block element.\n\t\tmsg = msg.replace(/\\s*<blockquote>/gm, '<blockquote>')\n\t\tmsg = msg.replace(/<\\/blockquote>\\s*/gm, '</blockquote>')\n\n\t\t# Remove new-line between blockquotes.\n\t\tmsg = msg.replace(/<\\/blockquote>\\n<blockquote>/gm, '</blockquote><blockquote>')\n\n\t\tif not _.isString message\n\t\t\tmessage.html = msg\n\t\telse\n\t\t\tmessage = msg\n\n\t\tconsole.log 'Markdown', message if window?.rocketDebug\n\n\t\treturn message\n\nRocketChat.callbacks.add 'renderMessage', Markdown, RocketChat.callbacks.priority.HIGH\nRocketChat.Markdown = Markdown\n\nif Meteor.isClient\n\tBlaze.registerHelper 'RocketChatMarkdown', (text) ->\n\t\treturn RocketChat.Markdown text\n"]}