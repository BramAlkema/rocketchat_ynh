{"version":3,"sources":["meteor://ðŸ’»app/livechat.js","meteor://ðŸ’»app/server/startup.js","meteor://ðŸ’»app/permissions.js","meteor://ðŸ’»app/config.js","meteor://ðŸ’»app/client/stylesheets/load.js","meteor://ðŸ’»app/server/methods/addAgent.js","meteor://ðŸ’»app/server/methods/addManager.js","meteor://ðŸ’»app/server/methods/changeLivechatStatus.js","meteor://ðŸ’»app/server/methods/getCustomFields.js","meteor://ðŸ’»app/server/methods/pageVisited.js","meteor://ðŸ’»app/server/methods/registerGuest.js","meteor://ðŸ’»app/server/methods/removeAgent.js","meteor://ðŸ’»app/server/methods/removeCustomField.js","meteor://ðŸ’»app/server/methods/removeDepartment.js","meteor://ðŸ’»app/server/methods/removeManager.js","meteor://ðŸ’»app/server/methods/removeTrigger.js","meteor://ðŸ’»app/server/methods/saveCustomField.js","meteor://ðŸ’»app/server/methods/saveDepartment.js","meteor://ðŸ’»app/server/methods/saveSurveyFeedback.js","meteor://ðŸ’»app/server/methods/saveTrigger.js","meteor://ðŸ’»app/server/methods/searchAgent.js","meteor://ðŸ’»app/server/methods/sendMessageLivechat.js","meteor://ðŸ’»app/server/methods/setCustomField.js","meteor://ðŸ’»app/server/models/Users.js","meteor://ðŸ’»app/server/models/Rooms.js","meteor://ðŸ’»app/server/models/LivechatCustomField.js","meteor://ðŸ’»app/server/models/LivechatDepartment.js","meteor://ðŸ’»app/server/models/LivechatDepartmentAgents.js","meteor://ðŸ’»app/server/models/LivechatPageVisited.js","meteor://ðŸ’»app/server/models/LivechatTrigger.js","meteor://ðŸ’»app/server/lib/getNextAgent.js","meteor://ðŸ’»app/server/publications/availableDepartments.js","meteor://ðŸ’»app/server/publications/customFields.js","meteor://ðŸ’»app/server/publications/departmentAgents.js","meteor://ðŸ’»app/server/publications/livechatAgents.js","meteor://ðŸ’»app/server/publications/livechatDepartments.js","meteor://ðŸ’»app/server/publications/livechatManagers.js","meteor://ðŸ’»app/server/publications/trigger.js","meteor://ðŸ’»app/server/publications/visitorInfo.js","meteor://ðŸ’»app/server/publications/visitorPageVisited.js","meteor://ðŸ’»app/server/publications/visitorRoom.js"],"names":[],"mappings":"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","file":"/packages/rocketchat_livechat.js","sourcesContent":["/* globals WebApp:true */\n\nWebApp = Package.webapp.WebApp;\nconst Autoupdate = Package.autoupdate.Autoupdate;\n\nWebApp.connectHandlers.use('/livechat/', (req, res/*, next*/) => {\n\tres.setHeader('content-type', 'text/html; charset=utf-8');\n\n\tconst head = Assets.getText('public/head.html');\n\n\tconst html = `<html>\n\t\t<head>\n\t\t\t<link rel=\"stylesheet\" type=\"text/css\" class=\"__meteor-css__\" href=\"/packages/rocketchat_livechat/public/livechat.css?_dc=${Autoupdate.autoupdateVersion}\">\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\t__meteor_runtime_config__ = ${JSON.stringify(__meteor_runtime_config__)};\n\t\t\t</script>\n\t\t\t<script type=\"text/javascript\" src=\"/packages/rocketchat_livechat/public/livechat.js?_dc=${Autoupdate.autoupdateVersion}\"></script>\n\n\t\t\t${head}\n\t\t</head>\n\t\t<body>\n\t\t</body>\n\t</html>`;\n\n\tres.write(html);\n\tres.end();\n});\n","Meteor.startup(() => {\n\tRocketChat.roomTypes.setPublish('l', (identifier) => {\n\t\treturn RocketChat.models.Rooms.findByTypeAndName('l', identifier, {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\tv: 1,\n\t\t\t\tlivechatData: 1\n\t\t\t}\n\t\t});\n\t});\n});\n","Meteor.startup(() => {\n\tvar roles = _.pluck(RocketChat.models.Roles.find().fetch(), 'name');\n\tif (roles.indexOf('livechat-agent') === -1) {\n\t\tRocketChat.models.Roles.createOrUpdate('livechat-agent');\n\t}\n\tif (roles.indexOf('livechat-manager') === -1) {\n\t\tRocketChat.models.Roles.createOrUpdate('livechat-manager');\n\t}\n\tif (roles.indexOf('livechat-guest') === -1) {\n\t\tRocketChat.models.Roles.createOrUpdate('livechat-guest');\n\t}\n\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\tRocketChat.models.Permissions.createOrUpdate('view-l-room', ['livechat-agent', 'livechat-manager', 'admin']);\n\t\tRocketChat.models.Permissions.createOrUpdate('view-livechat-manager', ['livechat-manager', 'admin']);\n\t}\n});\n","Meteor.startup(function() {\n\tRocketChat.settings.addGroup('Livechat');\n\tRocketChat.settings.add('Livechat_title'       , 'Rocket.Chat', { type: 'string', group: 'Livechat', public: true });\n\tRocketChat.settings.add('Livechat_title_color' , '#C1272D',     { type: 'string', group: 'Livechat', public: true });\n\tRocketChat.settings.add('Livechat_enabled' ,     false,          { type: 'boolean', group: 'Livechat', public: true });\n\tRocketChat.settings.add('Livechat_registration_form' , true,    { type: 'boolean', group: 'Livechat', public: true, i18nLabel: 'Show_preregistration_form' });\n});\n","RocketChat.theme.addPackageAsset(() => {\n\treturn Assets.getText('client/stylesheets/livechat.less');\n});\n","Meteor.methods({\n\t'livechat:addAgent' (username) {\n\t\tif (!Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'view-livechat-manager')) {\n\t\t\tthrow new Meteor.Error('not-authorized');\n\t\t}\n\n\t\tif (!username || !_.isString(username)) {\n\t\t\tthrow new Meteor.Error('invalid-arguments');\n\t\t}\n\n\t\tvar user = RocketChat.models.Users.findOneByUsername(username, { fields: { _id: 1 } });\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('user-not-found', 'Username_not_found');\n\t\t}\n\n\t\tif (RocketChat.authz.addUserRoles(user._id, 'livechat-agent')) {\n\t\t\tRocketChat.models.Users.setOperator(user._id, true);\n\t\t\tRocketChat.models.Users.setLivechatStatus(user._id, 'available');\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\t'livechat:addManager' (username) {\n\t\tif (!Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'view-livechat-manager')) {\n\t\t\tthrow new Meteor.Error('not-authorized');\n\t\t}\n\n\t\tif (!username || !_.isString(username)) {\n\t\t\tthrow new Meteor.Error('invalid-arguments');\n\t\t}\n\n\t\tvar user = RocketChat.models.Users.findOneByUsername(username, { fields: { _id: 1 } });\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('user-not-found', 'Username_not_found');\n\t\t}\n\n\t\treturn RocketChat.authz.addUserRoles(user._id, 'livechat-manager');\n\t}\n});\n","Meteor.methods({\n\t'livechat:changeLivechatStatus'() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized');\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tlet newStatus = user.statusLivechat === 'available' ? 'not-available' : 'available';\n\n\t\treturn RocketChat.models.Users.setLivechatStatus(user._id, newStatus);\n\t}\n});\n","Meteor.methods({\n\t'livechat:getCustomFields'() {\n\t\treturn RocketChat.models.LivechatCustomField.find().fetch();\n\t}\n});\n","Meteor.methods({\n\t'livechat:pageVisited' (token, pageInfo) {\n\t\treturn RocketChat.models.LivechatPageVisited.saveByToken(token, pageInfo);\n\t}\n});\n","Meteor.methods({\n\t'livechat:registerGuest': function({ token, name, email, department } = {}) {\n\t\tvar qt, user, userData, userExists, userId, inc = 0;\n\n\t\tcheck(token, String);\n\n\t\tuser = Meteor.users.findOne({\n\t\t\t'profile.token': token\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (user != null) {\n\t\t\tthrow new Meteor.Error('token-already-exists', 'Token already exists');\n\t\t}\n\n\t\twhile (true) {\n\t\t\tqt = Meteor.users.find({\n\t\t\t\t'profile.guest': true\n\t\t\t}).count() + 1;\n\n\t\t\tuser = 'guest-' + (qt + inc++);\n\n\t\t\tuserExists = Meteor.users.findOne({\n\t\t\t\t'username': user\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!userExists) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tuserData = {\n\t\t\tusername: user,\n\t\t\tglobalRoles: ['livechat-guest'],\n\t\t\tdepartment: department,\n\t\t\ttype: 'visitor'\n\t\t};\n\n\t\tuserData.userAgent = this.connection.httpHeaders['user-agent'];\n\t\tuserData.ip = this.connection.httpHeaders['x-real-ip'] || this.connection.clientAddress;\n\t\tuserData.host = this.connection.httpHeaders.host;\n\n\t\tuserId = Accounts.insertUserDoc({}, userData);\n\n\t\tconst updateUser = {\n\t\t\tname: name || user,\n\t\t\t'profile.guest': true,\n\t\t\t'profile.token': token\n\t\t};\n\n\t\tif (email && email.trim() !== '') {\n\t\t\tupdateUser.emails = [{ address: email }];\n\t\t}\n\n\t\tvar stampedToken = Accounts._generateStampedLoginToken();\n\t\tvar hashStampedToken = Accounts._hashStampedToken(stampedToken);\n\n\t\tupdateUser.services = {\n\t\t\tresume: {\n\t\t\t\tloginTokens: [ hashStampedToken ]\n\t\t\t}\n\t\t};\n\n\t\tMeteor.users.update(userId, {\n\t\t\t$set: updateUser\n\t\t});\n\n\t\t// update visited page history to not expire\n\t\tRocketChat.models.LivechatPageVisited.keepHistoryForToken(token);\n\n\t\treturn {\n\t\t\tuserId: userId,\n\t\t\ttoken: stampedToken.token\n\t\t};\n\t}\n});\n","Meteor.methods({\n\t'livechat:removeAgent' (username) {\n\t\tif (!Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'view-livechat-manager')) {\n\t\t\tthrow new Meteor.Error('not-authorized');\n\t\t}\n\n\t\tif (!username || !_.isString(username)) {\n\t\t\tthrow new Meteor.Error('invalid-arguments');\n\t\t}\n\n\t\tvar user = RocketChat.models.Users.findOneByUsername(username, { fields: { _id: 1 } });\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('user-not-found', 'Username_not_found');\n\t\t}\n\n\t\tif (RocketChat.authz.removeUserFromRoles(user._id, 'livechat-agent')) {\n\t\t\tRocketChat.models.Users.setOperator(user._id, false);\n\t\t\tRocketChat.models.Users.setLivechatStatus(user._id, 'not-available');\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\t'livechat:removeCustomField' (_id) {\n\t\tif (!Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'view-livechat-manager')) {\n\t\t\tthrow new Meteor.Error('not-authorized');\n\t\t}\n\n\t\tcheck(_id, String);\n\n\t\tvar customField = RocketChat.models.LivechatCustomField.findOneById(_id, { fields: { _id: 1 } });\n\n\t\tif (!customField) {\n\t\t\tthrow new Meteor.Error('error-invalid-custom-field', 'Custom field not found', { method: 'livechat:removeCustomField' });\n\t\t}\n\n\t\treturn RocketChat.models.LivechatCustomField.removeById(_id);\n\t}\n});\n","Meteor.methods({\n\t'livechat:removeDepartment' (_id) {\n\t\tif (!Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'view-livechat-manager')) {\n\t\t\tthrow new Meteor.Error('not-authorized');\n\t\t}\n\n\t\tcheck(_id, String);\n\n\t\tvar department = RocketChat.models.LivechatDepartment.findOneById(_id, { fields: { _id: 1 } });\n\n\t\tif (!department) {\n\t\t\tthrow new Meteor.Error('department-not-found', 'Department_not_found');\n\t\t}\n\n\t\treturn RocketChat.models.LivechatDepartment.removeById(_id);\n\t}\n});\n","Meteor.methods({\n\t'livechat:removeManager' (username) {\n\t\tif (!Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'view-livechat-manager')) {\n\t\t\tthrow new Meteor.Error('not-authorized');\n\t\t}\n\n\t\tcheck(username, String);\n\n\t\tvar user = RocketChat.models.Users.findOneByUsername(username, { fields: { _id: 1 } });\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('user-not-found', 'Username_not_found');\n\t\t}\n\n\t\treturn RocketChat.authz.removeUserFromRoles(user._id, 'livechat-manager');\n\t}\n});\n","Meteor.methods({\n\t'livechat:removeTrigger' (/*trigger*/) {\n\t\tif (!Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'view-livechat-manager')) {\n\t\t\tthrow new Meteor.Error('not-authorized');\n\t\t}\n\n\t\treturn RocketChat.models.LivechatTrigger.removeAll();\n\t}\n});\n","/* eslint new-cap: [2, {\"capIsNewExceptions\": [\"Match.ObjectIncluding\", \"Match.Optional\"]}] */\n\nMeteor.methods({\n\t'livechat:saveCustomField' (_id, customFieldData) {\n\t\tif (!Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'view-livechat-manager')) {\n\t\t\tthrow new Meteor.Error('not-authorized');\n\t\t}\n\n\t\tif (_id) {\n\t\t\tcheck(_id, String);\n\t\t}\n\n\t\tcheck(customFieldData, Match.ObjectIncluding({ field: String, label: String, scope: String, visibility: String }));\n\n\t\tif (!/^[0-9a-zA-Z-_]+$/.test(customFieldData.field)) {\n\t\t\tthrow new Meteor.Error('error-invalid-custom-field-nmae', 'Invalid custom field name. Use only letters, numbers, hyphens and underscores.', { method: 'livechat:saveCustomField' });\n\t\t}\n\n\t\tif (_id) {\n\t\t\tconst customField = RocketChat.models.LivechatCustomField.findOneById(_id);\n\t\t\tif (!customField) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-custom-field', 'Custom Field Not found', { method: 'livechat:saveCustomField' });\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.models.LivechatCustomField.createOrUpdateCustomField(_id, customFieldData.field, customFieldData.label, customFieldData.scope, customFieldData.visibility);\n\t}\n});\n","/* eslint new-cap: [2, {\"capIsNewExceptions\": [\"Match.ObjectIncluding\", \"Match.Optional\"]}] */\n\nMeteor.methods({\n\t'livechat:saveDepartment' (_id, departmentData, departmentAgents) {\n\t\tif (!Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'view-livechat-manager')) {\n\t\t\tthrow new Meteor.Error('not-authorized');\n\t\t}\n\n\t\tif (_id) {\n\t\t\tcheck(_id, String);\n\t\t}\n\n\t\tcheck(departmentData, Match.ObjectIncluding({ enabled: Boolean, name: String, description: Match.Optional(String), agents: Match.Optional([Match.ObjectIncluding({ _id: String, username: String })]) }));\n\n\t\tif (_id) {\n\t\t\tconst department = RocketChat.models.LivechatDepartment.findOneById(_id);\n\t\t\tif (!department) {\n\t\t\t\tthrow new Meteor.Error('department-not-found', 'Department_not_found');\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.models.LivechatDepartment.createOrUpdateDepartment(_id, departmentData.enabled, departmentData.name, departmentData.description, departmentAgents);\n\t}\n});\n","/* eslint new-cap: [2, {\"capIsNewExceptions\": [\"Match.ObjectIncluding\"]}] */\n\nMeteor.methods({\n\t'livechat:saveSurveyFeedback' (visitorToken, visitorRoom, formData) {\n\t\tcheck(visitorToken, String);\n\t\tcheck(visitorRoom, String);\n\t\tcheck(formData, [Match.ObjectIncluding({ name: String, value: String })]);\n\n\t\tconst visitor = RocketChat.models.Users.getVisitorByToken(visitorToken);\n\t\tconst room = RocketChat.models.Rooms.findOneById(visitorRoom);\n\n\t\tif (visitor !== undefined && room !== undefined && room.v !== undefined && visitor.profile !== undefined && room.v.token === visitor.profile.token) {\n\t\t\tconst updateData = {};\n\t\t\tfor (var item of formData) {\n\t\t\t\tif (_.contains(['satisfaction', 'agentKnowledge', 'agentResposiveness', 'agentFriendliness'], item.name) && _.contains(['1','2','3','4','5'], item.value)) {\n\t\t\t\t\tupdateData[item.name] = item.value;\n\t\t\t\t} else if (item.name === 'additionalFeedback') {\n\t\t\t\t\tupdateData[item.name] = item.value;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!_.isEmpty(updateData)) {\n\t\t\t\treturn RocketChat.models.Rooms.updateSurveyFeedbackById(room._id, updateData);\n\t\t\t}\n\t\t}\n\t}\n});\n","Meteor.methods({\n\t'livechat:saveTrigger' (trigger) {\n\t\tif (!Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'view-livechat-manager')) {\n\t\t\tthrow new Meteor.Error('not-authorized');\n\t\t}\n\n\t\treturn RocketChat.models.LivechatTrigger.save(trigger);\n\t}\n});\n","Meteor.methods({\n\t'livechat:searchAgent' (username) {\n\t\tif (!Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'view-livechat-manager')) {\n\t\t\tthrow new Meteor.Error('not-authorized');\n\t\t}\n\n\t\tif (!username || !_.isString(username)) {\n\t\t\tthrow new Meteor.Error('invalid-arguments');\n\t\t}\n\n\t\tvar user = RocketChat.models.Users.findOneByUsername(username, { fields: { _id: 1, username: 1 } });\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('user-not-found', 'Username_not_found');\n\t\t}\n\n\t\treturn user;\n\t}\n});\n","Meteor.methods({\n\tsendMessageLivechat: function(message) {\n\t\tvar guest, agent, room;\n\n\t\tcheck(message.rid, String);\n\t\tcheck(message.token, String);\n\n\t\tguest = Meteor.users.findOne(Meteor.userId(), {\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tdepartment: 1\n\t\t\t}\n\t\t});\n\n\t\troom = RocketChat.models.Rooms.findOneById(message.rid);\n\t\tif (room == null) {\n\n\t\t\t// if no department selected verify if there is only one active and use it\n\t\t\tif (!guest.department) {\n\t\t\t\tvar departments = RocketChat.models.LivechatDepartment.findEnabledWithAgents();\n\t\t\t\tif (departments.count() === 1) {\n\t\t\t\t\tguest.department = departments.fetch()[0]._id;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tagent = getNextAgent(guest.department);\n\t\t\tif (!agent) {\n\t\t\t\tthrow new Meteor.Error('no-agent-online', 'Sorry, no online agents');\n\t\t\t}\n\t\t\tRocketChat.models.Rooms.insert({\n\t\t\t\t_id: message.rid,\n\t\t\t\tname: guest.username,\n\t\t\t\tmsgs: 1,\n\t\t\t\tlm: new Date(),\n\t\t\t\tusernames: [agent.username, guest.username],\n\t\t\t\tt: 'l',\n\t\t\t\tts: new Date(),\n\t\t\t\tv: {\n\t\t\t\t\ttoken: message.token\n\t\t\t\t}\n\t\t\t});\n\t\t\tRocketChat.models.Subscriptions.insert({\n\t\t\t\trid: message.rid,\n\t\t\t\tname: guest.username,\n\t\t\t\talert: true,\n\t\t\t\topen: true,\n\t\t\t\tunread: 1,\n\t\t\t\tanswered: false,\n\t\t\t\tu: {\n\t\t\t\t\t_id: agent.agentId,\n\t\t\t\t\tusername: agent.username\n\t\t\t\t},\n\t\t\t\tt: 'l',\n\t\t\t\tdesktopNotifications: 'all',\n\t\t\t\tmobilePushNotifications: 'all',\n\t\t\t\temailNotifications: 'all'\n\t\t\t});\n\t\t}\n\t\troom = Meteor.call('canAccessRoom', message.rid, guest._id);\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('cannot-acess-room');\n\t\t}\n\t\treturn RocketChat.sendMessage(guest, message, room);\n\t}\n});\n","Meteor.methods({\n\t'livechat:setCustomField' (token, key, value) {\n\t\tconst customField = RocketChat.models.LivechatCustomField.findOneById(key);\n\t\tif (customField) {\n\t\t\tif (customField.scope === 'room') {\n\t\t\t\treturn RocketChat.models.Rooms.updateLivechatDataByToken(token, key, value);\n\t\t\t} else {\n\t\t\t\t// Save in user\n\t\t\t\treturn RocketChat.models.Users.updateLivechatDataByToken(token, key, value);\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","/**\n * Sets an user as (non)operator\n * @param {string} _id - User's _id\n * @param {boolean} operator - Flag to set as operator or not\n */\nRocketChat.models.Users.setOperator = function(_id, operator) {\n\tvar update = {\n\t\t$set: {\n\t\t\toperator: operator\n\t\t}\n\t};\n\n\treturn this.update(_id, update);\n};\n\n/**\n * Gets all online agents\n * @return\n */\nRocketChat.models.Users.findOnlineAgents = function() {\n\tvar query = {\n\t\tstatus: 'online',\n\t\troles: 'livechat-agent'\n\t};\n\n\treturn this.find(query);\n};\n\n/**\n * Find online users from a list\n * @param {array} userList - array of usernames\n * @return\n */\nRocketChat.models.Users.findOnlineUserFromList = function(userList) {\n\tvar query = {\n\t\tstatusConnection: { $ne: 'offline' },\n\t\tstatusLivechat: 'available',\n\t\tusername: {\n\t\t\t$in: [].concat(userList)\n\t\t}\n\t};\n\n\treturn this.find(query);\n};\n\n/**\n * Get next user agent in order\n * @return {object} User from db\n */\nRocketChat.models.Users.getNextAgent = function() {\n\tvar query = {\n\t\tstatusConnection: { $ne: 'offline' },\n\t\tstatusLivechat: 'available',\n\t\troles: 'livechat-agent'\n\t};\n\n\tvar collectionObj = this.model.rawCollection();\n\tvar findAndModify = Meteor.wrapAsync(collectionObj.findAndModify, collectionObj);\n\n\tvar sort = {\n\t\tlivechatCount: 1,\n\t\tusername: 1\n\t};\n\n\tvar update = {\n\t\t$inc: {\n\t\t\tlivechatCount: 1\n\t\t}\n\t};\n\n\tvar user = findAndModify(query, sort, update);\n\tif (user) {\n\t\treturn {\n\t\t\tagentId: user._id,\n\t\t\tusername: user.username\n\t\t};\n\t} else {\n\t\treturn null;\n\t}\n};\n\n/**\n * Gets visitor by token\n * @param {string} token - Visitor token\n */\nRocketChat.models.Users.getVisitorByToken = function(token, options) {\n\tvar query = {\n\t\t'profile.guest': true,\n\t\t'profile.token': token\n\t};\n\n\treturn this.findOne(query, options);\n};\n\n/**\n * Gets visitor by token\n * @param {string} token - Visitor token\n */\nRocketChat.models.Users.findVisitorByToken = function(token) {\n\tvar query = {\n\t\t'profile.guest': true,\n\t\t'profile.token': token\n\t};\n\n\treturn this.find(query);\n};\n\n/**\n * Change user's livechat status\n * @param {string} token - Visitor token\n */\nRocketChat.models.Users.setLivechatStatus = function(userId, status) {\n\tlet query = {\n\t\t'_id': userId\n\t};\n\n\tlet update = {\n\t\t$set: {\n\t\t\t'statusLivechat': status\n\t\t}\n\t};\n\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Users.updateLivechatDataByToken = function(token, key, value) {\n\tconst query = {\n\t\t'profile.token': token\n\t};\n\n\tconst update = {\n\t\t$set: {\n\t\t\t[`livechatData.${key}`]: value\n\t\t}\n\t};\n\n\treturn this.upsert(query, update);\n};\n\n","/**\n * Gets visitor by token\n * @param {string} token - Visitor token\n */\nRocketChat.models.Rooms.updateSurveyFeedbackById = function(_id, surveyFeedback) {\n\tconst query = {\n\t\t_id: _id\n\t};\n\n\tconst update = {\n\t\t$set: {\n\t\t\tsurveyFeedback: surveyFeedback\n\t\t}\n\t};\n\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Rooms.updateLivechatDataByToken = function(token, key, value) {\n\tconst query = {\n\t\t'v.token': token\n\t};\n\n\tconst update = {\n\t\t$set: {\n\t\t\t[`livechatData.${key}`]: value\n\t\t}\n\t};\n\n\treturn this.upsert(query, update);\n};\n","/**\n * Livechat Custom Fields model\n */\nclass LivechatCustomField extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper();\n\t\tthis._initModel('livechat_custom_field');\n\t}\n\n\t// FIND\n\tfindOneById(_id, options) {\n\t\tconst query = { _id: _id };\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tcreateOrUpdateCustomField(_id, field, label, scope, visibility, extraData) {\n\t\tvar record = {\n\t\t\tlabel: label,\n\t\t\tscope: scope,\n\t\t\tvisibility: visibility\n\t\t};\n\n\t\t_.extend(record, extraData);\n\n\t\tif (_id) {\n\t\t\tthis.update({ _id: _id }, { $set: record });\n\t\t} else {\n\t\t\trecord._id = field;\n\t\t\t_id = this.insert(record);\n\t\t}\n\n\t\treturn record;\n\t}\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\tconst query = { _id: _id };\n\n\t\treturn this.remove(query);\n\t}\n}\n\nRocketChat.models.LivechatCustomField = new LivechatCustomField();\n","/**\n * Livechat Department model\n */\nclass LivechatDepartment extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper();\n\t\tthis._initModel('livechat_department');\n\t}\n\n\t// FIND\n\tfindOneById(_id, options) {\n\t\tconst query = { _id: _id };\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindByDepartmentId(_id, options) {\n\t\tconst query = { _id: _id };\n\n\t\treturn this.find(query, options);\n\t}\n\n\tcreateOrUpdateDepartment(_id, enabled, name, description, agents, extraData) {\n\t\tagents = [].concat(agents);\n\n\t\tvar record = {\n\t\t\tenabled: enabled,\n\t\t\tname: name,\n\t\t\tdescription: description,\n\t\t\tnumAgents: agents.length\n\t\t};\n\n\t\t_.extend(record, extraData);\n\n\t\tif (_id) {\n\t\t\tthis.update({ _id: _id }, { $set: record });\n\t\t} else {\n\t\t\t_id = this.insert(record);\n\t\t}\n\n\t\tvar savedAgents = _.pluck(RocketChat.models.LivechatDepartmentAgents.findByDepartmentId(_id).fetch(), 'agentId');\n\t\tvar agentsToSave = _.pluck(agents, 'agentId');\n\n\t\t// remove other agents\n\t\t_.difference(savedAgents, agentsToSave).forEach((agentId) => {\n\t\t\tRocketChat.models.LivechatDepartmentAgents.removeByDepartmentIdAndAgentId(_id, agentId);\n\t\t});\n\n\t\tagents.forEach((agent) => {\n\t\t\tRocketChat.models.LivechatDepartmentAgents.saveAgent({\n\t\t\t\tagentId: agent.agentId,\n\t\t\t\tdepartmentId: _id,\n\t\t\t\tusername: agent.username,\n\t\t\t\tcount: parseInt(agent.count),\n\t\t\t\torder: parseInt(agent.order)\n\t\t\t});\n\t\t});\n\n\t\treturn _.extend(record, { _id: _id });\n\t}\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\tconst query = { _id: _id };\n\n\t\treturn this.remove(query);\n\t}\n\n\tfindEnabledWithAgents() {\n\t\tvar query = {\n\t\t\tnumAgents: { $gt: 0 },\n\t\t\tenabled: true\n\t\t};\n\t\treturn this.find(query);\n\t}\n}\n\nRocketChat.models.LivechatDepartment = new LivechatDepartment();\n","/**\n * Livechat Department model\n */\nclass LivechatDepartmentAgents extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper();\n\t\tthis._initModel('livechat_department_agents');\n\t}\n\n\tfindByDepartmentId(departmentId) {\n\t\treturn this.find({ departmentId: departmentId });\n\t}\n\n\tsaveAgent(agent) {\n\t\treturn this.upsert({\n\t\t\tagentId: agent.agentId,\n\t\t\tdepartmentId: agent.departmentId\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tusername: agent.username,\n\t\t\t\tcount: parseInt(agent.count),\n\t\t\t\torder: parseInt(agent.order)\n\t\t\t}\n\t\t});\n\t}\n\n\tremoveByDepartmentIdAndAgentId(departmentId, agentId) {\n\t\tthis.remove({ departmentId: departmentId, agentId: agentId });\n\t}\n\n\tgetNextAgentForDepartment(departmentId) {\n\t\tvar agents = this.findByDepartmentId(departmentId).fetch();\n\n\t\tif (agents.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar onlineUsers = RocketChat.models.Users.findOnlineUserFromList(_.pluck(agents, 'username'));\n\n\t\tvar onlineUsernames = _.pluck(onlineUsers.fetch(), 'username');\n\n\t\tvar query = {\n\t\t\tdepartmentId: departmentId,\n\t\t\tusername: {\n\t\t\t\t$in: onlineUsernames\n\t\t\t}\n\t\t};\n\n\t\tvar sort = {\n\t\t\tcount: 1,\n\t\t\tsort: 1,\n\t\t\tusername: 1\n\t\t};\n\t\tvar update = {\n\t\t\t$inc: {\n\t\t\t\tcount: 1\n\t\t\t}\n\t\t};\n\n\t\tvar collectionObj = this.model.rawCollection();\n\t\tvar findAndModify = Meteor.wrapAsync(collectionObj.findAndModify, collectionObj);\n\n\t\tvar agent = findAndModify(query, sort, update);\n\t\tif (agent) {\n\t\t\treturn {\n\t\t\t\tagentId: agent.agentId,\n\t\t\t\tusername: agent.username\n\t\t\t};\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\nRocketChat.models.LivechatDepartmentAgents = new LivechatDepartmentAgents();\n","/**\n * Livechat Page Visited model\n */\nclass LivechatPageVisited extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper();\n\t\tthis._initModel('livechat_page_visited');\n\n\t\tthis.tryEnsureIndex({ 'token': 1 });\n\t\tthis.tryEnsureIndex({ 'ts': 1 });\n\n\t\t// keep history for 1 month if the visitor does not register\n\t\tthis.tryEnsureIndex({ 'expireAt': 1 }, { sparse: 1, expireAfterSeconds: 0 });\n\t}\n\n\tsaveByToken(token, pageInfo) {\n\t\t// keep history of unregistered visitors for 1 month\n\t\tvar keepHistoryMiliseconds = 2592000000;\n\n\t\treturn this.insert({\n\t\t\ttoken: token,\n\t\t\tpage: pageInfo,\n\t\t\tts: new Date(),\n\t\t\texpireAt: new Date().getTime() + keepHistoryMiliseconds\n\t\t});\n\t}\n\n\tfindByToken(token) {\n\t\treturn this.find({ token: token }, { sort : { ts: -1 }, limit: 20 });\n\t}\n\n\tkeepHistoryForToken(token) {\n\t\treturn this.update({\n\t\t\ttoken: token,\n\t\t\texpireAt: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\texpireAt: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n}\n\nRocketChat.models.LivechatPageVisited = new LivechatPageVisited();\n","/**\n * Livechat Trigger model\n */\nclass LivechatTrigger extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper();\n\t\tthis._initModel('livechat_trigger');\n\t}\n\n\t// FIND\n\tsave(data) {\n\t\tconst trigger = this.findOne();\n\n\t\tif (trigger) {\n\t\t\treturn this.update({ _id: trigger._id }, { $set: data });\n\t\t} else {\n\t\t\treturn this.insert(data);\n\t\t}\n\t}\n\n\tremoveAll() {\n\t\tthis.remove({});\n\t}\n}\n\nRocketChat.models.LivechatTrigger = new LivechatTrigger();\n","/* exported getNextAgent */\n\nthis.getNextAgent = function(department) {\n\tif (department) {\n\t\treturn RocketChat.models.LivechatDepartmentAgents.getNextAgentForDepartment(department);\n\t} else {\n\t\treturn RocketChat.models.Users.getNextAgent();\n\t}\n};\n","Meteor.publish('livechat:availableDepartments', function() {\n\treturn RocketChat.models.LivechatDepartment.findEnabledWithAgents();\n});\n","Meteor.publish('livechat:customFields', function(_id) {\n\tif (!this.userId) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\tif (!RocketChat.authz.hasPermission(this.userId, 'view-l-room')) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\tif (s.trim(_id)) {\n\t\treturn RocketChat.models.LivechatCustomField.find({ _id: _id });\n\t}\n\n\treturn RocketChat.models.LivechatCustomField.find();\n\n});\n","Meteor.publish('livechat:departmentAgents', function(departmentId) {\n\tif (!this.userId) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\tif (!RocketChat.authz.hasPermission(this.userId, 'view-livechat-manager')) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\treturn RocketChat.models.LivechatDepartmentAgents.find({ departmentId: departmentId });\n});\n","Meteor.publish('livechat:agents', function() {\n\tif (!this.userId) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\tif (!RocketChat.authz.hasPermission(this.userId, 'view-livechat-manager')) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\tvar self = this;\n\n\tvar handle = RocketChat.authz.getUsersInRole('livechat-agent').observeChanges({\n\t\tadded(id, fields) {\n\t\t\tself.added('agentUsers', id, fields);\n\t\t},\n\t\tchanged(id, fields) {\n\t\t\tself.changed('agentUsers', id, fields);\n\t\t},\n\t\tremoved(id) {\n\t\t\tself.removed('agentUsers', id);\n\t\t}\n\t});\n\n\tself.ready();\n\n\tself.onStop(function() {\n\t\thandle.stop();\n\t});\n});\n","Meteor.publish('livechat:departments', function(_id) {\n\tif (!this.userId) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\tif (!RocketChat.authz.hasPermission(this.userId, 'view-livechat-manager')) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\tif (_id !== undefined) {\n\t\treturn RocketChat.models.LivechatDepartment.findByDepartmentId(_id);\n\t} else {\n\t\treturn RocketChat.models.LivechatDepartment.find();\n\t}\n\n});\n","Meteor.publish('livechat:managers', function() {\n\tif (!this.userId) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\tif (!RocketChat.authz.hasPermission(this.userId, 'view-livechat-manager')) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\tvar self = this;\n\n\tvar handle = RocketChat.authz.getUsersInRole('livechat-manager').observeChanges({\n\t\tadded(id, fields) {\n\t\t\tself.added('managerUsers', id, fields);\n\t\t},\n\t\tchanged(id, fields) {\n\t\t\tself.changed('managerUsers', id, fields);\n\t\t},\n\t\tremoved(id) {\n\t\t\tself.removed('managerUsers', id);\n\t\t}\n\t});\n\n\tself.ready();\n\n\tself.onStop(function() {\n\t\thandle.stop();\n\t});\n});\n","Meteor.publish('livechat:trigger', function() {\n\treturn RocketChat.models.LivechatTrigger.find();\n});\n","Meteor.publish('livechat:visitorInfo', function(roomId) {\n\tif (!this.userId) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\tif (!RocketChat.authz.hasPermission(this.userId, 'view-l-room')) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\tvar room = RocketChat.models.Rooms.findOneById(roomId);\n\n\tif (room && room.v && room.v.token) {\n\t\treturn RocketChat.models.Users.findVisitorByToken(room.v.token);\n\t} else {\n\t\treturn this.ready();\n\t}\n});\n","Meteor.publish('livechat:visitorPageVisited', function(roomId) {\n\tif (!this.userId) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\tif (!RocketChat.authz.hasPermission(this.userId, 'view-l-room')) {\n\t\tthrow new Meteor.Error('not-authorized');\n\t}\n\n\tvar room = RocketChat.models.Rooms.findOneById(roomId);\n\n\tif (room && room.v && room.v.token) {\n\t\treturn RocketChat.models.LivechatPageVisited.findByToken(room.v.token);\n\t} else {\n\t\treturn this.ready();\n\t}\n});\n","Meteor.publish('livechat:visitorRoom', function(visitorToken) {\n\treturn RocketChat.models.Rooms.findByVisitorToken(visitorToken, {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tcl: 1,\n\t\t\tu: 1,\n\t\t\tusernames: 1,\n\t\t\tv: 1\n\t\t}\n\t});\n});\n"]}